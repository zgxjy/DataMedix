### **DataMedix 应用功能测试用例文档**

#### **一、 测试环境准备**

1.  **数据库**:
    *   **DB1**: PostgreSQL 服务器，包含 **MIMIC-IV v2.2** 数据库（例如，库名 `mimiciv22`）。
    *   **DB2**: PostgreSQL 服务器，包含 **MIMIC-IV v3.1** 数据库（例如，库名 `mimiciv31`）。
    *   **DB3**: PostgreSQL 服务器，包含 **e-ICU v2.0** 数据库（例如，库名 `eicu`）。
2.  **应用程序**: 运行最新版本的 `MedicalDataExtractor`。
3.  **工具**: 数据库客户端（如 DBeaver, pgAdmin）用于验证后台数据。

#### **二、 通用功能测试**

| 测试用例ID | 测试模块 | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **G-01** | **主窗口与布局** | 1. 启动应用。<br>2. 拖动、缩放、最大化、最小化窗口。<br>3. 点击工具栏的“结构查看”、“数据字典”、“SQL实验室”按钮。 | 1. 应用正常启动，标题显示默认数据库类型。<br>2. 窗口操作流畅。<br>3. 对应的Dock窗口正确显示和隐藏，可以拖动和组合。 |
| **G-02** | **数据库连接** | 1. 在下拉框选择“MIMIC-IV”。<br>2. 输入DB1的正确连接信息，点击“连接测试并应用”。<br>3. 点击“断开连接”。<br>4. 切换到“e-ICU”，重复步骤2-3（使用DB3信息）。 | 1. 连接成功后，输入框锁定，断开按钮启用。<br>2. 断开后，输入框解锁，连接按钮启用。<br>3. 切换数据库后，连接状态重置。 |

---

#### **三、 核心流程与面板测试 (MIMIC-IV v2.2)**

*   **前置条件**: 在应用中连接到MIMIC-IV v2.2数据库。

| 测试用例ID | 测试模块/Panel | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **MIMIC-C-01** | **队列创建** | 1. **Tab 2**: 筛选模式选“按疾病ICD筛选”。<br>2. 条件：`long_title` 包含 `sepsis`。<br>3. 点击“查询代码”，再点击“创建...”，命名为`sepsis_first_cohort`。<br>4. **Tab 1**: 切换到另一筛选模式“按手术/操作ICD筛选”。<br>5. 条件：`long_title` 包含 `aortic` AND `replace`。<br>6. 入院类型选“所有事件入院”，创建队列 `aortic_all_cohort`。 | 1. `sepsis_first_cohort` 表成功创建在 `mimiciv_data` schema下，包含数据。<br>2. 切换模式后，UI功能正常，可继续创建。<br>3. `aortic_all_cohort` 表成功创建，行数应大于等于“首次事件入院”的结果。 |
| **MIMIC-B-01** | **基础数据提取** | 1. **Tab 3**: 选择上一步创建的 `sepsis_first_cohort`。<br>2. 勾选“住院及人口学信息”和“患者评分”。<br>3. 点击“SQL确认预览”，再点击“提取基础数据”。 | 1. SQL预览生成正确。<br>2. 操作成功后，`sepsis_first_cohort` 表中增加了 `gender`, `admission_age`, `sofa`, `sapsii` 等列，且值不全为NULL。 |
| **MIMIC-S-01** | **专项: Chartevents** | 1. **Tab 4**: 选择 `sepsis_first_cohort`。<br>2. 数据来源选“监测指标 (chartevents)”。<br>3. 筛选条件：`label` 包含 `Heart Rate`。点击“筛选”。<br>4. 从列表中选择 "Heart Rate" (ID: 220045)。<br>5. 提取逻辑：勾选“平均值”、“最大值”。时间窗口：“ICU入住后24小时”。<br>6. 命名为 `hr_icu24h`，点击“执行合并”。 | 1. 筛选出心率相关的项目。<br>2. `sepsis_first_cohort` 表中新增 `hr_icu24h_mean`, `hr_icu24h_max` 两列，且有数值。 |
| **MIMIC-S-02** | **专项: Labevents** | 1. **Tab 4**: 选择 `sepsis_first_cohort`。<br>2. 数据来源选“化验 (labevents)”。<br>3. 筛选条件：`label` 包含 `Lactate`。点击“筛选”。<br>4. 选择 "Lactate" (ID: 50813)。<br>5. 提取逻辑：勾选“第一次测量值”。时间窗口：“整个住院期间”。<br>6. 命名为 `lactate_first_hosp`，执行合并。 | 1. 表中新增 `lactate_first_hosp_first_value` 列，且有数值。 |
| **MIMIC-S-03** | **专项: Procedures** | 1. **Tab 4**: 选择 `aortic_all_cohort`。<br>2. 数据来源选“操作/手术 (procedures_icd)”。<br>3. 筛选条件：`long_title` 包含 `Endovascular Replacement`。点击“筛选”。<br>4. 全选筛选出的所有项目。<br>5. 提取逻辑：勾选“是否存在”。时间窗口：“整个住院期间”。<br>6. 命名为 `proc_endo_replace`，执行合并。 | 1. 表中新增 `proc_endo_replace_exists` 列，值应大部分为TRUE。 |
| **MIMIC-S-04** | **专项: Notes (Radiology)** | 1. **Tab 4**: 选择 `sepsis_first_cohort`。<br>2. 数据来源选“临床笔记 (note)”。<br>3. 笔记类型选“放射学报告”。<br>4. 筛选条件：主文本包含 `consolidation`，检查名称包含 `CHEST`，报告状态为 `Final`。<br>5. 提取逻辑：勾选“拼接所有匹配的笔记文本”。时间窗口：“整个ICU期间”。<br>6. 快捷提取：勾选“射血分数 (EF)”。<br>7. 命名为 `cxr_consolidation`，执行合并。 | 1. 表中新增 `cxr_consolidation_note_concat` 和 `cxr_consolidation_ef` 两列。`note_concat`列应包含相关报告，`ef`列可能为NULL或有数值。 |
| **MIMIC-S-05** | **专项: Notes (Discharge)** | 1. **Tab 4**: 选择 `sepsis_first_cohort`。<br>2. 数据来源选“临床笔记 (note)”。<br>3. 笔记类型选“出院小结”。<br>4. 提取逻辑：勾选“计算匹配的笔记数量”。时间窗口：“整个住院期间”。<br>5. 命名为 `d_sum`，执行合并。 | 1. 表中新增 `d_sum_note_count` 列，值通常为1或0。 |

---

#### **四、 核心流程与面板测试 (MIMIC-IV v3.1)**

*   **前置条件**: 在应用中连接到MIMIC-IV v3.1数据库。

| 测试用例ID | 测试模块/Panel | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **MIMIC3-C-01** | **队列创建** | (同 MIMIC-C-01) 创建 `sepsis_first_cohort_v3`。 | 队列创建成功，行数可能与v2.2不同。 |
| **MIMIC3-S-01** | **专项: Notes (容错)** | 1. **Tab 4**: 选择 `sepsis_first_cohort_v3`。<br>2. 数据来源选“临床笔记 (note)”。 | 1. **重要**: 由于v3.1没有note相关的表，**程序不应崩溃**。理想情况下，UI应给出提示（如“当前数据库不支持此功能”），或SQL执行时报错，但应用本身保持稳定。 |

---

#### **五、 核心流程与面板测试 (e-ICU v2.0)**

*   **前置条件**: 在应用中连接到e-ICU v2.0数据库。

| 测试用例ID | 测试模块/Panel | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **EICU-C-01** | **队列创建** | 1. **Tab 2**: 筛选模式选“按诊断字符串筛选”。<br>2. 条件：`diagnosisstring` 包含 `sepsis`。<br>3. 创建队列 `eicu_sepsis_cohort`。 | 1. `eicu_sepsis_cohort` 表成功创建在 `eicu_data` schema下，包含数据。 |
| **EICU-B-01** | **基础数据提取** | 1. **Tab 3**: 选择 `eicu_sepsis_cohort`。<br>2. 勾选“人口学及APACHE-IVa评分”。<br>3. 点击“SQL确认预览”，再点击“提取基础数据”。 | 1. 表中增加了 `gender`, `age`, `apachescore` 等列，且有值。 |
| **EICU-S-01** | **专项: Lab** | 1. **Tab 4**: 选择 `eicu_sepsis_cohort`。<br>2. 数据来源选“化验 (lab)”。<br>3. 筛选条件：`labname` 包含 `lactate`。点击“筛选”。<br>4. 列表选择 "lactate"。<br>5. 提取逻辑：勾选“最小值”、“最大值”。时间窗口：“ICU入院后24小时”。<br>6. 命名为 `lactate_icu24h`，执行合并。 | 1. 表中新增 `lactate_icu24h_min`, `lactate_icu24h_max` 两列，且有数值。 |
| **EICU-S-02** | **专项: VitalPeriodic** | 1. **Tab 4**: 选择 `eicu_sepsis_cohort`。<br>2. 数据来源选“生命体征-高频 (vitalperiodic)”。<br>3. 生命体征项选 `heartrate`。<br>4. 提取逻辑：勾选“平均值”。时间窗口：“整个ICU期间”。<br>5. 命名为 `hr_icu_all`，执行合并。 | 1. 表中新增 `hr_icu_all_mean` 列，且有数值。 |
| **EICU-S-03** | **专项: NurseCharting** | 1. **Tab 4**: 选择 `eicu_sepsis_cohort`。<br>2. 数据来源选“护理记录 (nursecharting)”。<br>3. 护理记录项选 `GCS Total`。<br>4. 提取值来源选“数值”。<br>5. 提取逻辑：勾选“最小值”。时间窗口：“ICU入院后24小时”。<br>6. 命名为 `gcs_min24h`，执行合并。 | 1. 表中新增 `gcs_min24h_min` 列，且有数值。 |
| **EICU-S-04** | **专项: InfusionDrug** | 1. **Tab 4**: 选择 `eicu_sepsis_cohort`。<br>2. 数据来源选“输液药物 (infusiondrug)”。<br>3. 药物名称包含 `norepinephrine`。<br>4. 提取逻辑：勾选“是否存在”。时间窗口：“整个ICU期间”。<br>5. 命名为 `used_norepi`，执行合并。 | 1. 表中新增 `used_norepi_exists` 列，值为TRUE或NULL。 |
| **EICU-S-05** | **专项: Diagnosis** | 1. **Tab 4**: 选择 `eicu_sepsis_cohort`。<br>2. 数据来源选“诊断 (diagnosis)”。<br>3. 诊断字符串包含 `acute kidney failure`。<br>4. 提取逻辑：勾选“是否存在”。时间窗口：“整个ICU期间”。<br>5. 命名为 `dx_aki`，执行合并。 | 1. 表中新增 `dx_aki_exists` 列，值为TRUE或NULL。 |

#### **六、 辅助工具测试**

| 测试用例ID | 测试模块 | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- |
| **TOOL-01** | **数据字典** | 1. 连接MIMIC-IV v2.2。<br>2. 打开“数据字典”工具。<br>3. 搜索字典表选“监测/输出/操作项”。<br>4. 条件：`label` 包含 `glucose`，`category` 包含 `Labs`。<br>5. 点击“执行搜索”。 | 1. SQL预览正确生成。<br>2. 结果表格中显示血糖相关的 `d_items` 条目。 |
| **TOOL-02** | **数据导出** | 1. 连接任一数据库。<br>2. **Tab 5**: 刷新并选择之前创建的任一队列表。<br>3. 点击“预览数据”。<br>4. 选择导出格式为CSV，指定路径，点击“导出数据”。<br>5. 重复步骤4，格式为Excel。 | 1. 数据预览成功显示。<br>2. CSV和Excel文件成功生成在指定位置，内容正确。 |
| **TOOL-03** | **SQL实验室联动** | 1. 连接任一数据库。<br>2. 打开“结构查看”工具，刷新。<br>3. 右键点击一个表（如`mimiciv_icu.icustays`），选择“在SQL实验室中预览”。<br>4. SQL实验室窗口弹出，自动填入 `SELECT * ... LIMIT 100;` 并执行。 | 1. SQL实验室自动执行查询并显示结果。 |
| **TOOL-04** | **数据合并** | 1. 打开“数据合并”工具。<br>2. 加载两个本地CSV文件（需提前准备，包含共同的ID列）。<br>3. 在左右两侧选择要合并的键和要保留的列。<br>4. 选择“Inner Join”，点击“执行合并”。<br>5. 点击“导出合并结果”。 | 1. 预览区正确显示合并后的数据。<br>2. 导出的文件内容正确。 |

---

# 测试反馈

## MIMICIV-测试反馈：

1. mimiciv 的note的结果非常困难，建议单独提取思考